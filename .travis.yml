env:
  global:
    - GIT_COMMITTED_AT=$(if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then git log -1 --pretty=format:%ct; else git log -1 --skip 1 --pretty=format:%ct; fi)
language: php
php:
     - 7.1
before_script:
      - curl -s http://getcomposer.org/installer | php
      - php composer.phar install
jobs:
  include:
    - stage: Test and Type-check
      services:
      - docker
      before_install:
      - docker pull phpunit/phpunit
      - docker pull phpqa/psalm
      script:
      - docker run -v $(pwd):/data --rm phpunit/phpunit
      - docker run --rm --volume $(pwd):/data phpqa/psalm
    - stage: Generate/Deploy Docs
      before_script:
      - curl -O http://get.sensiolabs.org/sami.phar
      script:
      - php sami.phar update sami-config.php --force